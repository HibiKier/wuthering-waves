<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Zhenxun Ã— WutheringWaves ç™»å½•</title>
  <link rel="icon" href="https://web-static.kurobbs.com/resource/prod/icon.ico" type="image/x-icon">
  <script src="https://static.geetest.com/v4/gt4.js"></script>
  <script src="https://apps.bdimg.com/libs/jquery/1.6.4/jquery.min.js"></script>
  <style>
    body,
    html {
      height: 100%;
      margin: 0;
      font-family: 'HarmonyOS Sans', 'PingFang SC', 'Microsoft YaHei', Arial, sans-serif;
      background: linear-gradient(120deg, #a1c4fd 0%, #c2e9fb 100%);
      min-height: 100vh;
      position: relative;
    }

    .bg-gradient {
      position: fixed;
      inset: 0;
      background: url('https://prod-alicdn-community.kurobbs.com/forum/465dcb694966492aba4d4982c47f0e8520240914.jpg') center/cover no-repeat;
      filter: blur(0px) brightness(0.85);
      z-index: 0;
    }

    .center-card {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255, 255, 255, 0.22);
      border-radius: 2.5rem;
      box-shadow: 0 8px 40px 0 rgba(31, 38, 135, 0.18);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      border: 1px solid rgba(255, 255, 255, 0.18);
      width: 370px;
      max-width: 96vw;
      padding: 2.8rem 2rem 1.5rem 2rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      z-index: 2;
      animation: fadeIn 1s cubic-bezier(.68, -0.55, .27, 1.55);
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translate(-50%, -40%) scale(0.96);
      }

      to {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }
    }

    .brand-coop {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 1.2rem;
      gap: 1.2rem;
    }

    .brand-logo {
      width: 48px;
      height: 48px;
      border-radius: 1.2rem;
      background: #fff;
      border: 2px solid rgba(255, 255, 255, 0.7);
      box-shadow: 0 2px 8px rgba(102, 126, 234, 0.10);
      transition: transform 0.2s;
    }

    .brand-logo:hover {
      transform: scale(1.08) rotate(-5deg);
      box-shadow: 0 8px 32px rgba(102, 126, 234, 0.18);
    }

    .brand-x {
      font-size: 2.2rem;
      font-weight: 900;
      color: #fff;
      text-shadow: 0 2px 8px #aabbee;
      user-select: none;
      letter-spacing: 0.2em;
    }

    .main-title {
      font-size: 2rem;
      font-weight: 800;
      color: #fff;
      margin-bottom: 0.5rem;
      letter-spacing: 0.1em;
      text-shadow: 0 2px 8px #aabbee;
    }

    .sub-title {
      font-size: 1.1rem;
      color: #fff;
      opacity: 0.85;
      margin-bottom: 2rem;
      letter-spacing: 0.1em;
    }

    .pretty-form {
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 1.1rem;
      margin-top: 1.2rem;
    }

    .input-row {
      display: flex;
      align-items: center;
      gap: 0.7rem;
    }

    .input-row input {
      flex: 1;
      height: 44px;
      border: 1.2px solid #d0d7e2;
      border-radius: 1.2rem;
      background: #f7fafd;
      color: #222;
      font-size: 1rem;
      padding: 0 1rem;
      outline: none;
      transition: border 0.2s;
    }

    .input-row input:focus {
      border: 1.2px solid #7faaff;
      background: #fff;
    }

    .code-btn {
      height: 44px;
      border: none;
      border-radius: 1.2rem;
      background: #7faaff;
      color: #fff;
      font-weight: 600;
      font-size: 1rem;
      padding: 0 1.2rem;
      cursor: pointer;
      white-space: nowrap;
      transition: background 0.2s;
      min-width: 110px;
      box-sizing: border-box;
    }

    .code-btn:disabled {
      background: #e0e7ef;
      color: #aaa;
      cursor: not-allowed;
    }

    .code-btn:not(:disabled):hover {
      background: #5b8eea;
    }

    .main-btn {
      margin-top: 0.5rem;
      width: 100%;
      height: 48px;
      border: none;
      border-radius: 1.5rem;
      background: #7faaff;
      color: #fff;
      font-size: 1.15rem;
      font-weight: 700;
      letter-spacing: 0.05em;
      cursor: pointer;
      transition: background 0.2s;
    }

    .main-btn:disabled {
      background: #e0e7ef;
      color: #aaa;
      cursor: not-allowed;
    }

    .main-btn:not(:disabled):hover {
      background: #5b8eea;
    }

    .footer {
      margin-top: 2.2rem;
      color: #fff;
      font-size: 0.95rem;
      opacity: 0.7;
      letter-spacing: 0.1em;
      text-align: center;
    }

    @media (max-width: 480px) {
      .center-card {
        padding: 1.2rem 0.5rem;
        width: 99vw;
      }

      .brand-logo {
        width: 32px;
        height: 32px;
      }

      .main-title {
        font-size: 1.3rem;
      }

      .sub-title {
        font-size: 0.95rem;
      }
    }
  </style>
</head>

<body>
  <div class="bg-gradient"></div>
  <div class="center-card">
    <div class="brand-coop">
      <img src="/resources/image/icon.jpg" class="brand-logo" alt="Zhenxun">
      <span class="brand-x">Ã—</span>
      <img src="https://web-static.kurobbs.com/adminConfig/27/role_icon/1727419309663.png" class="brand-logo"
        alt="WutheringWaves">
    </div>
    <div class="main-title">é¸£æ½®ç™»å½•</div>
    <form id="loginForm" class="pretty-form">
      <div class="input-row">
        <input type="tel" id="phone" name="phone" maxlength="11" placeholder="æ‰‹æœºå·" required>
      </div>
      <div class="input-row">
        <input type="text" id="verificationCode" name="verificationCode" placeholder="éªŒè¯ç " required>
        <button type="button" id="getCodeBtn" class="code-btn" disabled>è·å–éªŒè¯ç </button>
      </div>
      <button type="submit" id="loginBtn" class="main-btn" disabled>ç™»å½•</button>
    </form>
    <div class="footer">
      <span>Â© {{ year }} Zhenxun Ã— WutheringWaves</span>
    </div>
  </div>

  <!-- æˆåŠŸæ¨¡æ€æ¡† -->
  <div id="successModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>ğŸ‰ ç™»å½•æˆåŠŸ</h2>
      <p>æ¬¢è¿å›æ¥ï¼</p>
      <p class="countdown">5ç§’åè‡ªåŠ¨è·³è½¬åˆ°é¦–é¡µ</p>
      <button class="redirect-button">ç«‹å³è·³è½¬</button>
    </div>
  </div>

  <script>
    // åˆ›å»ºæµ®åŠ¨ç²’å­
    function createParticles() {
      const particlesContainer = document.getElementById('particles');
      const particleCount = 20;

      for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.left = Math.random() * 100 + '%';
        particle.style.top = Math.random() * 100 + '%';
        particle.style.width = Math.random() * 4 + 2 + 'px';
        particle.style.height = particle.style.width;
        particle.style.animationDelay = Math.random() * 6 + 's';
        particle.style.animationDuration = (Math.random() * 3 + 3) + 's';
        particlesContainer.appendChild(particle);
      }
    }

    // é¡µé¢å…ƒç´ 
    const phoneInput = document.getElementById('phone');
    const verificationCodeInput = document.getElementById('verificationCode');
    const getCodeBtn = document.getElementById('getCodeBtn');
    const loginBtn = document.getElementById('loginBtn');
    const loginForm = document.getElementById('loginForm');
    const modal = document.getElementById('successModal');
    const closeBtn = modal.querySelector('.close');

    // è¾“å…¥éªŒè¯
    phoneInput.addEventListener('input', function () {
      getCodeBtn.disabled = this.value.length !== 11;
      loginBtn.disabled = this.value.length !== 11 || verificationCodeInput.value === "";
    });

    verificationCodeInput.addEventListener('input', function () {
      loginBtn.disabled = this.value === "" || phoneInput.value.length !== 11;
    });

    // æéªŒéªŒè¯ç é…ç½®
    const headers = {
      "devcode": generateRandomString(),
      "source": "h5",
    };

    const captchaId = "ec4aa4174277d822d73f2442a165a2cd";
    const product = "bind";

    initGeetest4({
      captchaId: captchaId,
      product: product,
    }, function (captcha) {
      captcha.onReady(function () {}).onSuccess(function () {
        var result = captcha.getValidate();
        if (!result) {
          return alert('è¯·å®ŒæˆéªŒè¯');
        }
        result.captcha_id = captchaId;

        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        getCodeBtn.innerHTML = '<span class="loading"></span>';

        $.ajax({
          url: 'https://api.kurobbs.com/user/getSmsCodeForH5',
          type: 'POST',
          data: {
            "mobile": phoneInput.value,
            "geeTestData": JSON.stringify(result)
          },
          headers: headers,
          success: res => {
            if (res.success) {
              showToast('éªŒè¯ç å·²å‘é€', 'success');
            } else {
              showToast('éªŒè¯ç å‘é€å¤±è´¥: ' + res.msg, 'error');
            }
          },
          error: () => showToast('ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œè¯·é‡è¯•', 'error')
        });
      }).onError(function () {
        showToast('éªŒè¯æœåŠ¡å¼‚å¸¸ï¼Œè¯·é‡è¯•', 'error');
      });

      getCodeBtn.onclick = function () {
        this.disabled = true;
        let countdown = 60;
        const originalText = this.textContent;

        captcha.showBox();

        const timer = setInterval(() => {
          this.textContent = `${countdown}ç§’åé‡è¯•`;
          countdown--;
          if (countdown < 0) {
            clearInterval(timer);
            this.textContent = originalText;
            this.disabled = false;
            captcha.hideBox();
          }
        }, 1000);
      }
    });

    // ç™»å½•è¡¨å•æäº¤
    loginForm.addEventListener('submit', function (e) {
      e.preventDefault();

      const data = {
        mobile: phoneInput.value,
        code: verificationCodeInput.value,
        auth: "{{ auth }}"
      };

      // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
      loginBtn.innerHTML = '<span class="loading"></span> ç™»å½•ä¸­...';
      loginBtn.disabled = true;

      $.ajax({
        url: '{{ submit_url }}',
        type: 'POST',
        data: JSON.stringify(data),
        contentType: 'application/json',
        success: res => {
          if (res.success) {
            showSuccessModal();
          } else {
            showToast('ç™»å½•å¤±è´¥: ' + (res.msg || 'è¯·é‡è¯•'), 'error');
            resetLoginButton();
          }
        },
        error: () => {
          showToast('ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥', 'error');
          resetLoginButton();
        }
      });
    });

    function resetLoginButton() {
      loginBtn.innerHTML = 'ç™»å½•';
      loginBtn.disabled = false;
      updateLoginButton();
    }

    // æˆåŠŸæ¨¡æ€æ¡†
    function showSuccessModal() {
      const homeHref = 'https://github.com/zhenxun-org/zhenxun_bot';
      const modal = document.getElementById('successModal');
      const countdownElement = modal.querySelector('.countdown');
      const redirectButton = modal.querySelector('.redirect-button');
      let countdown = 5;

      modal.classList.add('show');

      function updateCountdown() {
        countdownElement.textContent = `${countdown}ç§’åè‡ªåŠ¨è·³è½¬åˆ°é¦–é¡µ`;
        if (countdown <= 0) {
          clearInterval(timer);
          window.location.href = homeHref;
        }
        countdown--;
      }

      const timer = setInterval(updateCountdown, 1000);

      redirectButton.addEventListener('click', () => {
        clearInterval(timer);
        window.location.href = homeHref;
      });

      modal.querySelector('.close').addEventListener('click', () => {
        clearInterval(timer);
        window.location.href = homeHref;
      });
    }

    // æ¨¡æ€æ¡†å…³é—­
    closeBtn.addEventListener('click', closeModal);

    function closeModal() {
      modal.classList.remove('show');
    }

    window.addEventListener('click', function (event) {
      if (event.target === modal) {
        closeModal();
      }
    });

    // å·¥å…·å‡½æ•°
    function generateRandomString() {
      const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
      return Array(32)
        .fill(0)
        .map(() => chars.charAt(Math.floor(Math.random() * chars.length)))
        .join('');
    }

    // ç®€å•çš„æç¤ºæ¡†
    function showToast(message, type = 'info') {
      const toast = document.createElement('div');
      toast.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 1rem 1.5rem;
        border-radius: 8px;
        color: white;
        font-weight: 600;
        z-index: 10000;
        transform: translateX(100%);
        transition: transform 0.3s ease;
        background: ${type === 'success' ? '#4CAF50' : type === 'error' ? '#f44336' : '#2196F3'};
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      `;
      toast.textContent = message;
      document.body.appendChild(toast);

      setTimeout(() => {
        toast.style.transform = 'translateX(0)';
      }, 100);

      setTimeout(() => {
        toast.style.transform = 'translateX(100%)';
        setTimeout(() => {
          document.body.removeChild(toast);
        }, 300);
      }, 3000);
    }

    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function () {
      createParticles();
    });
  </script>
</body>

</html>